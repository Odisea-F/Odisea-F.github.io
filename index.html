<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oráculo de Odisea Finanzas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a1a;
            background-image:
                radial-gradient(circle at 15% 50%, rgba(173, 216, 230, 0.1), transparent 30%),
                radial-gradient(circle at 85% 30%, rgba(221, 160, 221, 0.1), transparent 40%);
            overflow: hidden;
        }
        .font-cinzel {
            font-family: 'Cinzel', serif;
        }
        #chat-container {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background-color: rgba(10, 10, 26, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .oraculo-message {
            background-color: rgba(45, 35, 80, 0.5);
            border-left: 3px solid #c9b0ff;
        }
        .user-message {
            background-color: rgba(30, 41, 59, 0.7);
            border-right: 3px solid #67e8f9;
        }
        #userInput:focus {
            box-shadow: 0 0 0 2px #c9b0ff;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        ::-webkit-scrollbar-thumb {
            background: #c9b0ff;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a881ff;
        }
        #astrolabio {
            transition: transform 1s ease-in-out;
        }
        .typing-indicator span {
            animation: blink 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes blink {
            0% { opacity: 0.2; }
            20% { opacity: 1; }
            100% { opacity: 0.2; }
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen text-white p-4">

    <div id="chat-container" class="w-full max-w-2xl h-full max-h-[90vh] rounded-2xl shadow-2xl flex flex-col">
        
        <div class="p-6 border-b border-white/10 flex items-center space-x-4">
            <div id="astrolabio-container" class="w-16 h-16 flex-shrink-0">
                 <!-- Astrolabio SVG Icon -->
                <svg id="astrolabio" viewBox="0 0 100 100" class="w-full h-full">
                    <defs>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="1.5" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <circle cx="50" cy="50" r="48" fill="none" stroke="#a881ff" stroke-width="1.5"/>
                    <circle cx="50" cy="50" r="38" fill="none" stroke="#c9b0ff" stroke-width="1"/>
                    <circle cx="50" cy="50" r="28" fill="none" stroke="#c9b0ff" stroke-width="1"/>
                    <circle id="gem" cx="50" cy="50" r="10" fill="#c9b0ff" filter="url(#glow)"/>
                    <path d="M50 2 L50 12 M98 50 L88 50 M50 98 L50 88 M2 50 L12 50" stroke="#c9b0ff" stroke-width="1.5"/>
                    <path d="M20 20 L30 30 M80 20 L70 30 M20 80 L30 70 M80 80 L70 70" stroke="#c9b0ff" stroke-width="1"/>
                </svg>
            </div>
            <div>
                <h1 class="text-2xl font-bold font-cinzel text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-cyan-300">Oráculo de Odisea</h1>
                <p class="text-sm text-purple-200/80">Tu guía en la travesía financiera.</p>
            </div>
        </div>

        <div id="chat-box" class="flex-1 p-6 overflow-y-auto space-y-4">
            <!-- Los mensajes del chat se agregarán aquí -->
        </div>

        <div class="p-4 border-t border-white/10">
            <div class="flex space-x-3">
                <input type="text" id="userInput" class="flex-1 bg-slate-800 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-shadow" placeholder="Escribe tu pregunta aquí...">
                <button id="sendButton" class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold py-2 px-5 rounded-lg shadow-lg transition-all transform hover:scale-105">
                    Enviar
                </button>
            </div>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const astrolabio = document.getElementById('astrolabio');

        // --- ¡IMPORTANTE! Pega tu API Key de Google AI Studio aquí ---
        const apiKey = "AIzaSyB4MBAo5vKuhPc0fv16WaS0fMH6yx4gSVQ";

        // --- Lógica del Oráculo con IA (El "Alma" del Chatbot) ---
        async function getOraculoAIResponse(pregunta) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            // La instrucción "secreta" que le da la personalidad al Oráculo
            const systemPrompt = "Eres el Oráculo de Odisea Finanzas, un sabio experto en finanzas personales para jóvenes en México. Tu personalidad es la de un oráculo mítico. Sigue estas 4 reglas SIEMPRE: 1. Inicia tu respuesta dirigiéndote al usuario como 'Navegante,'. 2. Usa una metáfora de la mitología griega o la Odisea para explicar el concepto. 3. Después de la metáfora, traduce el concepto a una explicación clara y directa usando la frase 'es decir,'. 4. Concluye con un consejo sabio o un llamado a la acción. Tu tono es inspirador y misterioso. Nunca revelas que eres una IA. No usas emojis.";

            const payload = {
                "contents": [{
                    "parts": [
                        { "text": systemPrompt },
                        { "text": "Pregunta del navegante: " + pregunta }
                    ]
                }]
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.json();
                    console.error("Error de la API:", errorBody);
                    return `Los cielos están nublados. Hubo un error al consultar al Oráculo (Error: ${response.status}). Asegúrate de que tu API Key sea correcta.`;
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    return "El Oráculo guarda silencio... No se encontró una respuesta en las estrellas.";
                }

            } catch (error) {
                console.error("Error de conexión:", error);
                return "Parece que hay una tormenta en la red... No se pudo contactar al Oráculo. Revisa tu conexión a internet.";
            }
        }
        
        // --- Funciones para manejar la interfaz del chat ---
        function addMessage(text, sender) {
            const messageId = `msg-${Date.now()}`;
            const messageElement = document.createElement('div');
            messageElement.id = messageId;
            
            if (sender === 'typing') {
                messageElement.className = 'oraculo-message self-start p-3 rounded-lg max-w-lg typing-indicator';
                messageElement.innerHTML = '<span>●</span><span>●</span><span>●</span>';
            } else {
                messageElement.className = `p-3 rounded-lg max-w-lg animate-fade-in-up ${sender === 'user' ? 'user-message self-end text-right' : 'oraculo-message self-start'}`;
                messageElement.textContent = text;
            }
            
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
            return messageId;
        }

        async function handleSend() {
            const userText = userInput.value;
            if (!userText.trim()) return;

            addMessage(userText, 'user');
            userInput.value = '';
            sendButton.disabled = true;

            const typingId = addMessage('', 'typing');

            const oraculoText = await getOraculoAIResponse(userText);
            
            const typingElement = document.getElementById(typingId);
            if(typingElement) {
                chatBox.removeChild(typingElement);
            }

            addMessage(oraculoText, 'oraculo');
            sendButton.disabled = false;
            
            astrolabio.style.transform = `rotate(${Math.random() * 360}deg)`;
        }

        sendButton.addEventListener('click', handleSend);
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                handleSend();
            }
        });

        window.addEventListener('load', () => {
            setTimeout(() => {
                addMessage("¡Bienvenido, navegante! Soy el Oráculo de Odisea. Hazme una pregunta sobre tu travesía financiera.", 'oraculo');
            }, 500);
        });
    </script>
</body>
</html>
